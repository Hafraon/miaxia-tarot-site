<!doctype html>
<html lang="uk">
  <head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NVMR3CJ2');</script>
    <!-- End Google Tag Manager -->
    
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/tarot.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MiaxiaLip | Ключ до вашого майбутнього</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Raleway:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <meta name="description" content="MiaxiaLip - пізнайте таємниці долі разом зі справжнім майстром таро. Індивідуальні розклади, любовні прогнози, кар'єрне консультування." />
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17416940719"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-7239891504"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      
      gtag('config', 'AW-17416940719');
      gtag('config', 'AW-7239891504');
      gtag('config', 'G-GDEVM541ZP');
    </script>
    
    <script type="module" crossorigin src="/assets/index-CVuxTPtp.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-BF3mJlfA.css">
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NVMR3CJ2"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <div id="root"></div>
    
    <!-- Telegram сповіщення - МІНІМАЛЬНА ВЕРСІЯ -->
    <script>
      // Конфігурація Telegram
      const TELEGRAM_CONFIG = {
        chatId: '603047391',
        botToken: '7322148325:AAHWjMEFuBVVoUhsPQ6SOsSTBE2fxFZfeXU',
        recipientEmail: 'miaxialip@gmail.com'
      };

      // Відправка в Telegram
      async function sendToTelegram(formData) {
        try {
          const response = await fetch('/telegram-notify.php', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
          });

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const result = await response.json();
          
          if (result.success) {
            return { success: true, data: result };
          } else {
            throw new Error(result.error || 'Telegram API error');
          }
        } catch (error) {
          console.error('Telegram service error:', error);
          throw error;
        }
      }

      // Розумний збір даних з форми - БЕЗ ЗАЙВИХ ПОЛІВ
      function smartFormDataCollection(form) {
        const inputs = Array.from(form.querySelectorAll('input, select, textarea'));
        
        const data = {
          name: '',
          email: '',
          phone: '',
          instagram: '',
          service: '',
          message: '',
          date: '',
          time: ''
        };
        
        inputs.forEach(input => {
          const value = input.value?.trim() || '';
          if (!value) return;
          
          const name = input.name?.toLowerCase() || '';
          const id = input.id?.toLowerCase() || '';
          const placeholder = input.placeholder?.toLowerCase() || '';
          const type = input.type?.toLowerCase() || '';
          
          const fieldText = `${name} ${id} ${placeholder}`.toLowerCase();
          
          // Ім'я
          if (!data.name && (fieldText.includes('name') || fieldText.includes('ім\'я') || fieldText.includes('імя'))) {
            data.name = value;
          }
          // Instagram (перевіряємо ПЕРЕД email!)
          else if (!data.instagram && (fieldText.includes('instagram') || fieldText.includes('інстаграм') || 
                   (value.includes('@') && !value.includes('.') && !value.includes('+')))) {
            data.instagram = value;
          }
          // Email
          else if (!data.email && (type === 'email' || fieldText.includes('email') || 
                   (value.includes('@') && value.includes('.')))) {
            data.email = value;
          }
          // Телефон
          else if (!data.phone && (type === 'tel' || fieldText.includes('phone') || fieldText.includes('телефон') || 
                   /^[\+]?[\d\s\-\(\)]{7,}$/.test(value))) {
            data.phone = value;
          }
          // Послуга
          else if (!data.service && (input.tagName === 'SELECT' || fieldText.includes('service') || fieldText.includes('послуга'))) {
            data.service = value;
          }
          // Повідомлення (тільки якщо користувач САМ додав поле)
          else if (!data.message && input.tagName === 'TEXTAREA') {
            data.message = value;
          }
          // Дата
          else if (!data.date && (type === 'date' || fieldText.includes('date') || fieldText.includes('дата'))) {
            data.date = value;
          }
          // Час
          else if (!data.time && (type === 'time' || fieldText.includes('time') || fieldText.includes('час'))) {
            data.time = value;
          }
        });
        
        return data;
      }

      // Універсальний обробник форм - БЕЗ ДОДАВАННЯ ЗАЙВИХ ПОЛІВ
      function initTelegramNotifications() {
        async function handleFormSubmit(event) {
          event.preventDefault();
          
          const form = event.target;
          const data = smartFormDataCollection(form);

          const hasAnyData = Object.values(data).some(value => value && value.trim());
          
          if (!hasAnyData) {
            console.log('Немає даних у формі');
            return;
          }

          const submitButton = form.querySelector('button[type="submit"]') || 
                             form.querySelector('input[type="submit"]') ||
                             form.querySelector('button');

          const originalText = submitButton ? (submitButton.textContent || submitButton.value) : '';
          
          if (submitButton) {
            submitButton.textContent = 'Відправляємо...';
            submitButton.disabled = true;
            submitButton.style.opacity = '0.7';
          }

          try {
            const result = await sendToTelegram(data);
            
            if (result.success) {
              // ПРАВИЛЬНІ конверсії Google Ads з GTM
              if (typeof gtag !== 'undefined') {
                // Конверсія для AW-7239891504
                gtag('event', 'conversion', {
                  'send_to': 'AW-7239891504/urnsCLD0n_waEK_ZhfFA',
                  'value': 100,
                  'currency': 'UAH'
                });
                
                // Конверсія для AW-17416940719
                gtag('event', 'conversion', {
                  'send_to': 'AW-17416940719/waLYCNbXjvwaEK_ZhfFA',
                  'value': 100,
                  'currency': 'UAH'
                });
                
                console.log('✅ Google Ads конверсії відправлені');
              }
              
              // GA4 подія
              if (typeof gtag !== 'undefined') {
                gtag('event', 'purchase', {
                  'transaction_id': 'TAROT_' + Date.now(),
                  'value': 100,
                  'currency': 'UAH',
                  'event_category': 'Замовлення',
                  'event_label': 'Таро консультація'
                });
              }
              
              // Очистити форму
              form.reset();
              
              console.log('✅ Замовлення відправлено успішно!');
              
            } else {
              console.error('❌ Помилка відправки:', result.error);
            }
            
          } catch (error) {
            console.error('❌ Помилка з\'єднання:', error);
          } finally {
            if (submitButton) {
              submitButton.textContent = originalText;
              submitButton.disabled = false;
              submitButton.style.opacity = '1';
            }
          }
        }

        // Пошук і обробка форм - БЕЗ ДОДАВАННЯ ЗАЙВИХ ПОЛІВ
        function attachToForms() {
          const forms = document.querySelectorAll('form');
          
          forms.forEach(form => {
            if (!form.hasAttribute('data-telegram-handler')) {
              form.setAttribute('data-telegram-handler', 'true');
              
              // НЕ ДОДАЄМО ЗАЙВІ ПОЛЯ!
              
              const newForm = form.cloneNode(true);
              form.parentNode.replaceChild(newForm, form);
              newForm.addEventListener('submit', handleFormSubmit);
              
              console.log('✅ Telegram system attached to form');
            }
          });
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', attachToForms);
        } else {
          attachToForms();
        }

        setInterval(attachToForms, 2000);
      }

      // Тестова функція
      window.testTelegram = async function() {
        const testData = {
          name: 'Тест системи',
          phone: '+380123456789',
          service: 'individual',
          message: 'Тестове повідомлення'
        };
        
        try {
          const result = await sendToTelegram(testData);
          console.log('✅ Test successful:', result);
        } catch (error) {
          console.error('❌ Test failed:', error);
        }
      };

      // Ініціалізація системи
      initTelegramNotifications();
      
      console.log('🚀 Мінімальна Telegram система готова!');
    </script>

    <!-- Стилі для виправлення горизонтальної прокрутки -->
    <style>
      html, body {
        overflow-x: hidden !important;
        max-width: 100vw !important;
      }
      
      * {
        box-sizing: border-box !important;
      }
      
      #root, #root > *, [class*="container"], [class*="wrapper"] {
        max-width: 100vw !important;
        overflow-x: hidden !important;
      }
      
      img, video, iframe {
        max-width: 100% !important;
        height: auto !important;
      }
      
      @media (min-width: 768px) {
        body {
          overflow-y: auto !important;
          overflow-x: hidden !important;
        }
      }
    </style>
  </body>
</html>