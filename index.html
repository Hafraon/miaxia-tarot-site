<!doctype html>
<html lang="uk">
  <head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NVMR3CJ2');</script>
    <!-- End Google Tag Manager -->
    
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/tarot.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MiaxiaLip | Ключ до вашого майбутнього</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Raleway:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Професійні консультації таро від MiaxiaLip. Точні прогнози, любовні розклади, кар'єрне консультування. 5 років досвіду, 2000+ задоволених клієнтів." />
    <meta name="keywords" content="таро, гадання, прогноз, любовний розклад, кар'єра, фінанси, майбутнє, долі, карти таро, консультація таролога, MiaxiaLip" />
    <meta name="author" content="MiaxiaLip" />
    <meta name="robots" content="index, follow" />
    <meta name="language" content="uk" />
    <meta name="geo.region" content="UA" />
    <meta name="geo.placename" content="Ukraine" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://miaxialip.com.ua/" />
    <meta property="og:title" content="MiaxiaLip - Професійні консультації таро | Точні прогнози долі" />
    <meta property="og:description" content="Пізнайте таємниці майбутнього з досвідченим тарологом. Індивідуальні розклади, любовні прогнози, кар'єрне консультування. 5 років досвіду." />
    <meta property="og:image" content="https://miaxialip.com.ua/images/miaxialip-og.jpg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="MiaxiaLip - Професійний таролог" />
    <meta property="og:site_name" content="MiaxiaLip Tarot" />
    <meta property="og:locale" content="uk_UA" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://miaxialip.com.ua/" />
    <meta name="twitter:title" content="MiaxiaLip - Професійні консультації таро" />
    <meta name="twitter:description" content="Точні прогнози долі від досвідченого таролога. Індивідуальні розклади, любовні прогнози, кар'єрне консультування." />
    <meta name="twitter:image" content="https://miaxialip.com.ua/images/miaxialip-og.jpg" />
    <meta name="twitter:image:alt" content="MiaxiaLip - Професійний таролог" />
    
    <!-- Additional Meta Tags -->
    <meta name="theme-color" content="#d4af37" />
    <meta name="msapplication-TileColor" content="#0a1128" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://miaxialip.com.ua/" />
    
    <!-- Schema.org JSON-LD -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "LocalBusiness",
      "name": "MiaxiaLip Tarot",
      "description": "Професійні консультації таро, точні прогнози долі, любовні розклади та кар'єрне консультування",
      "url": "https://miaxialip.com.ua",
      "logo": "https://miaxialip.com.ua/tarot.svg",
      "image": "https://miaxialip.com.ua/images/miaxialip-og.jpg",
      "telephone": "+380XXXXXXXXX",
      "email": "miaxialip@gmail.com",
      "founder": {
        "@type": "Person",
        "name": "Mia",
        "jobTitle": "Професійний таролог",
        "description": "Досвідчений таролог з 5-річним стажем, понад 2000 задоволених клієнтів"
      },
      "serviceType": "Таро консультації",
      "areaServed": {
        "@type": "Country",
        "name": "Ukraine"
      },
      "hasOfferCatalog": {
        "@type": "OfferCatalog",
        "name": "Послуги таро",
        "itemListElement": [
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "1 питання",
              "description": "Отримайте відповідь на одне конкретне питання"
            },
            "price": "100",
            "priceCurrency": "UAH"
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Любовний прогноз",
              "description": "Розклади на сумісність, перспективи стосунків"
            },
            "price": "350",
            "priceCurrency": "UAH"
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Кар'єра і фінанси",
              "description": "Аналіз фінансових можливостей та кар'єрного розвитку"
            },
            "price": "400",
            "priceCurrency": "UAH"
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Персональна матриця",
              "description": "Глибинний аналіз особистості через таро та нумерологію"
            },
            "price": "650",
            "priceCurrency": "UAH"
          }
        ]
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.9",
        "reviewCount": "2000",
        "bestRating": "5",
        "worstRating": "1"
      },
      "openingHours": "Mo-Su 11:00-02:00",
      "sameAs": [
        "https://www.instagram.com/miaxialip",
        "https://www.tiktok.com/@miaxialip2",
        "https://t.me/miaxiataro"
      ]
    }
    </script>
    
    <!-- FAQ Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "Скільки коштують консультації таро?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Ціни на послуги варіюються від 100 грн за одне питання до 650 грн за персональну матрицю. В телеграм-боті діють спеціальні знижки."
          }
        },
        {
          "@type": "Question",
          "name": "Як проходить консультація таро?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Після замовлення я зв'яжуся з вами протягом 2-3 годин для уточнення деталей. Консультація проходить онлайн з детальним розбором карт та рекомендаціями."
          }
        },
        {
          "@type": "Question",
          "name": "Який досвід у таролога MiaxiaLip?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "5 років професійного досвіду в таро, понад 2000 задоволених клієнтів, навчання у найкращих майстрів Європи."
          }
        }
      ]
    }
    </script>
    
    <!-- ВИПРАВЛЕНО: Правильні Google Ads конверсії -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17416940719"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'AW-17416940719');
      
      // Безпечна ініціалізація
      console.log('✅ Google Ads ініціалізовано: AW-17416940719');
    </script>
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NVMR3CJ2"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <div id="root"></div>
    
    <!-- Telegram сповіщення -->
    <script>
      // Конфігурація Telegram
      const TELEGRAM_CONFIG = {
        chatId: '603047391',
        botToken: '7322148325:AAHWjMEFuBVVoUhsPQ6SOsSTBE2fxFZfeXU',
        recipientEmail: 'miaxialip@gmail.com'
      };

      // Відправка в Telegram
      async function sendToTelegram(formData) {
        try {
          const response = await fetch('/telegram-notify.php', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
          });

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const result = await response.json();
          
          if (result.success) {
            return { success: true, data: result };
          } else {
            throw new Error(result.error || 'Telegram API error');
          }
        } catch (error) {
          console.error('Telegram service error:', error);
          throw error;
        }
      }

      // Функція для показу сповіщень
      function showNotification(message, type = 'info') {
        // Видалити попередні сповіщення
        const existingNotifications = document.querySelectorAll('.notification-popup');
        existingNotifications.forEach(notif => notif.remove());

        const notification = document.createElement('div');
        notification.className = 'notification-popup';
        
        const colors = {
          success: { bg: '#d4edda', border: '#c3e6cb', text: '#155724' },
          error: { bg: '#f8d7da', border: '#f5c6cb', text: '#721c24' },
          info: { bg: '#d1ecf1', border: '#bee5eb', text: '#0c5460' }
        };

        const color = colors[type] || colors.info;

        notification.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: ${color.bg};
          color: ${color.text};
          border: 2px solid ${color.border};
          padding: 20px 25px;
          border-radius: 12px;
          z-index: 10000;
          max-width: 400px;
          min-width: 300px;
          box-shadow: 0 8px 32px rgba(0,0,0,0.15);
          font-family: 'Raleway', Arial, sans-serif;
          font-size: 14px;
          line-height: 1.4;
          white-space: pre-line;
          transform: translateX(100%);
          transition: all 0.3s ease;
          cursor: pointer;
        `;

        notification.textContent = message;
        document.body.appendChild(notification);

        // Анімація появи
        setTimeout(() => {
          notification.style.transform = 'translateX(0)';
        }, 10);

        // Додати кнопку закриття
        const closeBtn = document.createElement('span');
        closeBtn.innerHTML = '✕';
        closeBtn.style.cssText = `
          position: absolute;
          top: 8px;
          right: 12px;
          cursor: pointer;
          font-size: 16px;
          opacity: 0.7;
          transition: opacity 0.2s;
        `;
        closeBtn.onmouseenter = () => closeBtn.style.opacity = '1';
        closeBtn.onmouseleave = () => closeBtn.style.opacity = '0.7';
        closeBtn.onclick = (e) => {
          e.stopPropagation();
          removeNotification(notification);
        };
        notification.appendChild(closeBtn);

        // Автоматичне приховання
        const hideTimeout = type === 'error' ? 8000 : 5000;
        setTimeout(() => removeNotification(notification), hideTimeout);

        // Приховання по кліку
        notification.onclick = () => removeNotification(notification);
      }

      function removeNotification(notification) {
        if (notification && notification.parentNode) {
          notification.style.transform = 'translateX(100%)';
          notification.style.opacity = '0';
          setTimeout(() => {
            if (notification.parentNode) {
              notification.remove();
            }
          }, 300);
        }
      }

      // Функція для розумного збору даних з поля
      function getFieldValue(input) {
        if (!input) return '';
        
        const value = input.value?.trim() || '';
        const name = input.name?.toLowerCase() || '';
        const id = input.id?.toLowerCase() || '';
        const placeholder = input.placeholder?.toLowerCase() || '';
        const type = input.type?.toLowerCase() || '';
        
        return {
          value: value,
          name: name,
          id: id,
          placeholder: placeholder,
          type: type,
          element: input
        };
      }

      // Розумний збір даних з форми
      function smartFormDataCollection(form) {
        const inputs = Array.from(form.querySelectorAll('input, select, textarea'));
        const fieldData = inputs.map(getFieldValue);
        
        console.log('Всі поля форми:', fieldData);
        
        const data = {
          name: '',
          email: '',
          phone: '',
          instagram: '',
          service: '',
          message: '',
          date: '',
          time: ''
        };
        
        // Збір даних по полях
        fieldData.forEach(field => {
          if (!field.value) return;
          
          const fieldText = `${field.name} ${field.id} ${field.placeholder}`.toLowerCase();
          
          // Ім'я
          if (!data.name && (
            fieldText.includes('name') || 
            fieldText.includes('ім\'я') || 
            fieldText.includes('імя') ||
            field.name === 'name' ||
            field.id === 'name'
          )) {
            data.name = field.value;
            console.log('✅ Знайдено ім\'я:', field.value);
          }
          
          // Instagram (перевіряємо ПЕРЕД email!)
          else if (!data.instagram && (
            fieldText.includes('instagram') ||
            fieldText.includes('інстаграм') ||
            fieldText.includes('інста') ||
            fieldText.includes('insta') ||
            // Instagram нікнейм: @ без крапки або спеціальні символи email
            (field.value.includes('@') && !field.value.includes('.') && !field.value.includes('+'))
          )) {
            data.instagram = field.value;
            console.log('✅ Знайдено Instagram:', field.value);
          }
          
          // Email (тепер перевіряємо більш точно)
          else if (!data.email && (
            field.type === 'email' ||
            fieldText.includes('email') ||
            fieldText.includes('е-мейл') ||
            fieldText.includes('емейл') ||
            // Email має містити @ і крапку (домен)
            (field.value.includes('@') && field.value.includes('.'))
          )) {
            data.email = field.value;
            console.log('✅ Знайдено email:', field.value);
          }
          
          // Телефон
          else if (!data.phone && (
            field.type === 'tel' ||
            fieldText.includes('phone') ||
            fieldText.includes('tel') ||
            fieldText.includes('телефон') ||
            fieldText.includes('номер') ||
            /^[\+]?[\d\s\-\(\)]{7,}$/.test(field.value)
          )) {
            data.phone = field.value;
            console.log('✅ Знайдено телефон:', field.value);
          }
          
          // Послуга
          else if (!data.service && (
            field.element.tagName === 'SELECT' ||
            fieldText.includes('service') ||
            fieldText.includes('послуга') ||
            fieldText.includes('тип') ||
            fieldText.includes('category')
          )) {
            data.service = field.value;
            console.log('✅ Знайдено послугу:', field.value);
          }
          
          // Повідомлення
          else if (!data.message && (
            field.element.tagName === 'TEXTAREA' ||
            fieldText.includes('message') ||
            fieldText.includes('повідомлення') ||
            fieldText.includes('коментар') ||
            fieldText.includes('додатково') ||
            fieldText.includes('примітка')
          )) {
            data.message = field.value;
            console.log('✅ Знайдено повідомлення:', field.value);
          }
          
          // Дата
          else if (!data.date && (
            field.type === 'date' ||
            fieldText.includes('date') ||
            fieldText.includes('дата') ||
            /^\d{4}-\d{2}-\d{2}$/.test(field.value)
          )) {
            data.date = field.value;
            console.log('✅ Знайдено дату:', field.value);
          }
          
          // Час
          else if (!data.time && (
            field.type === 'time' ||
            fieldText.includes('time') ||
            fieldText.includes('час') ||
            /^\d{2}:\d{2}$/.test(field.value)
          )) {
            data.time = field.value;
            console.log('✅ Знайдено час:', field.value);
          }
        });
        
        console.log('Фінальні дані:', data);
        return data;
      }

      // Універсальний обробник форм
      function initTelegramNotifications() {
        // Функція для обробки відправки форми
        async function handleFormSubmit(event) {
          event.preventDefault();
          
          const form = event.target;
          
          // Використовуємо розумний збір даних
          const data = smartFormDataCollection(form);

          // Валідація - хоча б одне поле має бути заповнено
          const hasAnyData = Object.values(data).some(value => value && value.trim());
          
          if (!hasAnyData) {
            showNotification('❌ Будь ласка, заповніть хоча б одне поле форми', 'error');
            console.log('Немає даних у формі');
            return;
          }

          // М'яка валідація - попереджуємо, але не блокуємо
          if (!data.name.trim() && !data.email.trim() && !data.phone.trim() && !data.instagram.trim()) {
            showNotification('⚠️ Додайте ім\'я, email, телефон або Instagram для кращого зв\'язку', 'info');
          }

          // Знайти кнопку відправки
          const submitButton = form.querySelector('button[type="submit"]') || 
                             form.querySelector('input[type="submit"]') ||
                             form.querySelector('button');

          const originalText = submitButton ? (submitButton.textContent || submitButton.value) : '';
          
          // Показати індикатор завантаження
          if (submitButton) {
            submitButton.textContent = 'Відправляємо...';
            submitButton.disabled = true;
            submitButton.style.opacity = '0.7';
            submitButton.style.cursor = 'wait';
          }

          try {
            // Відправити в Telegram
            const result = await sendToTelegram(data);
            
            if (result.success) {
              // Показати успішне повідомлення
              showNotification('🎉 Повідомлення відправлено!\n✅ Telegram сповіщення надіслано\n\nМи зв\'яжемося з вами найближчим часом!', 'success');
              
              // Очистити форму
              form.reset();
              
              // ВИПРАВЛЕНО: Правильна конверсія Google Ads
              try {
                if (typeof gtag !== 'undefined') {
                  gtag('event', 'conversion', {
                    'send_to': 'AW-17416940719/waLYCNbXjvwaEK_ZhfFA',
                    'value': 100,
                    'currency': 'UAH'
                  });
                  console.log('✅ Google Ads конверсія відправлена');
                }
              } catch (conversionError) {
                console.log('ℹ️ Google Ads конверсія не відправлена (заблокована):', conversionError.message);
              }
              
              // Додаткове повідомлення з контактами
              setTimeout(() => {
                showNotification('📞 Якщо терміново, пишіть напряму:\n📧 miaxialip@gmail.com\n📱 Instagram: @miaxialip', 'info');
              }, 3000);
              
            } else {
              showNotification('❌ Помилка відправки повідомлення.\nСпробуйте ще раз або зв\'яжіться напряму.', 'error');
            }
            
          } catch (error) {
            console.error('Form submission error:', error);
            
            let errorMessage = '❌ Помилка з\'єднання.\n\n';
            
            if (error.message.includes('HTTP 404')) {
              errorMessage += 'Сервіс тимчасово недоступний.';
            } else if (error.message.includes('Failed to fetch')) {
              errorMessage += 'Перевірте з\'єднання з інтернетом.';
            } else {
              errorMessage += 'Спробуйте пізніше або зв\'яжіться напряму.';
            }
            
            errorMessage += '\n\n📧 miaxialip@gmail.com\n📱 Instagram: @miaxialip';
            
            showNotification(errorMessage, 'error');
          } finally {
            // Відновити кнопку
            if (submitButton) {
              submitButton.textContent = originalText;
              submitButton.disabled = false;
              submitButton.style.opacity = '1';
              submitButton.style.cursor = 'pointer';
            }
          }
        }

        // Пошук і обробка форм
        function attachToForms() {
          const forms = document.querySelectorAll('form');
          
          forms.forEach(form => {
            // Перевірити, чи вже має обробник
            if (!form.hasAttribute('data-telegram-handler')) {
              form.setAttribute('data-telegram-handler', 'true');
              
              // Додати поле для повідомлення, якщо його немає
              addMessageFieldToForm(form);
              
              // Видалити існуючі обробники submit
              const newForm = form.cloneNode(true);
              form.parentNode.replaceChild(newForm, form);
              
              // Додати новий обробник
              newForm.addEventListener('submit', handleFormSubmit);
              
              console.log('✅ Telegram notification system attached to form');
            }
          });
        }

        // Функція для додавання поля повідомлення
        function addMessageFieldToForm(form) {
          // Перевірити, чи вже є поле для повідомлення
          const existingMessageField = form.querySelector('textarea, input[name*="message"], input[name*="comment"], input[name*="notes"]');
          
          if (!existingMessageField) {
            // Знайти кнопку відправки
            const submitButton = form.querySelector('button[type="submit"]') || form.querySelector('button');
            
            if (submitButton) {
              // Створити поле для повідомлення
              const messageField = document.createElement('div');
              messageField.style.marginBottom = '15px';
              messageField.innerHTML = `
                <label style="display: block; margin-bottom: 8px; color: #fff; font-family: 'Raleway', Arial, sans-serif; font-size: 14px;">
                  Додаткові побажання (необов'язково)
                </label>
                <textarea 
                  name="message" 
                  placeholder="Розкажіть більше про ваші питання або побажання..."
                  style="
                    width: 100%; 
                    padding: 12px; 
                    border: 1px solid rgba(255,255,255,0.3); 
                    border-radius: 8px; 
                    background: rgba(255,255,255,0.1); 
                    color: #fff; 
                    font-family: 'Raleway', Arial, sans-serif; 
                    font-size: 14px;
                    resize: vertical;
                    min-height: 80px;
                    box-sizing: border-box;
                  "
                ></textarea>
              `;
              
              // Вставити перед кнопкою
              submitButton.parentNode.insertBefore(messageField, submitButton);
              
              console.log('✅ Added message field to form');
            }
          }
        }

        // Запустити при завантаженні сторінки
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', attachToForms);
        } else {
          attachToForms();
        }

        // Перевіряти нові форми кожні 2 секунди (для динамічного контенту React)
        setInterval(attachToForms, 2000);
      }

      // Тестова функція для перевірки Telegram
      window.testTelegram = async function() {
        const testData = {
          name: 'Тест системи',
          email: 'test@example.com',
          phone: '+380123456789',
          instagram: '@test_user',
          service: 'Тестування',
          message: 'Це тестове повідомлення для перевірки роботи системи',
          date: new Date().toISOString().split('T')[0],
          time: new Date().toTimeString().split(' ')[0].slice(0,5)
        };
        
        try {
          const result = await sendToTelegram(testData);
          console.log('✅ Test successful:', result);
          showNotification('✅ Тест успішний! Система працює.', 'success');
        } catch (error) {
          console.error('❌ Test failed:', error);
          showNotification('❌ Тест не пройшов: ' + error.message, 'error');
        }
      };

      // Ініціалізація системи
      initTelegramNotifications();

      // Показати повідомлення про готовність системи
      setTimeout(() => {
        console.log('🚀 Telegram notification system is ready!');
        console.log('💡 Для тестування виконайте: testTelegram()');
      }, 1000);
    </script>

    <!-- Стилі для форм + виправлення горизонтальної прокрутки -->
    <style>
      /* Виправлення горизонтальної прокрутки */
      html, body {
        overflow-x: hidden !important;
        max-width: 100vw !important;
      }
      
      * {
        box-sizing: border-box !important;
      }
      
      /* Обмеження ширини для всіх контейнерів */
      #root, #root > *, [class*="container"], [class*="wrapper"] {
        max-width: 100vw !important;
        overflow-x: hidden !important;
      }
      
      /* Виправлення для широких елементів */
      img, video, iframe {
        max-width: 100% !important;
        height: auto !important;
      }
      
      /* Виправлення для таблиць */
      table {
        table-layout: fixed !important;
        width: 100% !important;
      }
      
      .notification-popup {
        font-family: 'Raleway', Arial, sans-serif !important;
      }
      
      /* Стилі для кнопок форм при відправці */
      button[disabled], input[disabled] {
        cursor: wait !important;
      }
      
      /* Анімація завантаження для кнопки */
      button[type="submit"]:disabled::after {
        content: "";
        display: inline-block;
        width: 12px;
        height: 12px;
        margin-left: 8px;
        border: 2px solid currentColor;
        border-radius: 50%;
        border-right-color: transparent;
        animation: button-loading 1s linear infinite;
      }
      
      @keyframes button-loading {
        to {
          transform: rotate(360deg);
        }
      }
      
      /* Стилі для красивіших сповіщень */
      .notification-popup:hover {
        transform: translateX(-5px) !important;
        box-shadow: 0 12px 40px rgba(0,0,0,0.2) !important;
      }
      
      /* Додаткові виправлення для десктопів */
      @media (min-width: 768px) {
        body {
          overflow-y: auto !important;
          overflow-x: hidden !important;
        }
        
        /* Центрування контенту на великих екранах */
        #root {
          margin: 0 auto !important;
          padding: 0 20px !important;
        }
      }
    </style>
    
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>