<!DOCTYPE html>
<html lang="uk">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NVMR3CJ2');</script>
    <!-- End Google Tag Manager -->
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î—è–∫—É—î–º–æ –∑–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è! | MiaxiaLip</title>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17416940719"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'AW-17416940719');
    </script>
    
    <style>
        body {
            font-family: 'Raleway', Arial, sans-serif;
            background: linear-gradient(135deg, #0a1128 0%, #1e3c72 50%, #2a5298 100%);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .thank-you-container {
            text-align: center;
            max-width: 600px;
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }
        .success-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        h1 {
            color: #d4af37;
            margin-bottom: 20px;
            font-size: 2.5em;
        }
        .message {
            font-size: 1.2em;
            line-height: 1.6;
            margin-bottom: 30px;
        }
        .contact-info {
            background: rgba(212, 175, 55, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .btn {
            display: inline-block;
            background: linear-gradient(135deg, #d4af37, #f5e0a2);
            color: #0a1128;
            padding: 15px 30px;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            margin: 10px;
            transition: transform 0.3s;
        }
        .btn:hover {
            transform: translateY(-3px);
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .debug-info {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            font-size: 12px;
            font-family: monospace;
            text-align: left;
        }
        .status-ok { color: #4CAF50; }
        .status-blocked { color: #f44336; }
        .status-warning { color: #ff9800; }
    </style>
    
    <!-- ENHANCED CONVERSION TRACKING -->
    <script>
      console.log('üéØ Thank You page loaded - initializing enhanced conversion tracking');
      
      // Initialize dataLayer
      window.dataLayer = window.dataLayer || [];
      
      // Get conversion value from URL parameters or use default
      const urlParams = new URLSearchParams(window.location.search);
      const conversionValue = parseInt(urlParams.get('value')) || 70;
      const serviceType = urlParams.get('service') || '–¢–∞—Ä–æ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è';
      
      console.log('üí∞ Conversion Value:', conversionValue);
      console.log('üîÆ Service Type:', serviceType);
      
      // Track blocked requests
      let blockedRequests = 0;
      let adBlockerDetected = false;
      
      // Enhanced tracking for thank you page
      document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ DOM loaded - sending conversion data...');
        
        // Detect ad blocker
        setTimeout(() => {
          // Check if gtag function exists and works
          if (typeof gtag !== 'function') {
            adBlockerDetected = true;
            console.warn('‚ö†Ô∏è Ad blocker detected - gtag function blocked');
          }
          
          // Test image pixel (blocked by ad blockers)
          const testImg = new Image();
          testImg.onload = () => console.log('‚úÖ Test pixel loaded - no ad blocker');
          testImg.onerror = () => {
            adBlockerDetected = true;
            console.warn('‚ö†Ô∏è Test pixel blocked - ad blocker detected');
          };
          testImg.src = 'https://googleads.g.doubleclick.net/test.gif?' + Date.now();
        }, 1000);
        
        // GA4 Purchase Event
        try {
          window.dataLayer.push({
            'event': 'purchase',
            'ecommerce': {
              'transaction_id': 'TAROT_' + Date.now(),
              'value': conversionValue,
              'currency': 'UAH',
              'items': [{
                'item_id': 'tarot_consultation',
                'item_name': serviceType,
                'category': 'Spiritual Services',
                'quantity': 1,
                'price': conversionValue
              }]
            },
            'conversion_value': conversionValue,
            'service_type': serviceType,
            'event_category': '–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è',
            'event_label': 'Completed Order',
            'custom_conversion': true
          });
          console.log('‚úÖ GA4 purchase event sent');
        } catch (e) {
          console.error('‚ùå GA4 event failed:', e);
        }
        
        // Additional conversion event
        try {
          window.dataLayer.push({
            'event': 'conversion_completed',
            'conversion_value': conversionValue,
            'currency': 'UAH',
            'service_type': serviceType,
            'conversion_source': 'website',
            'conversion_medium': 'organic'
          });
          console.log('‚úÖ Additional conversion event sent');
        } catch (e) {
          console.error('‚ùå Additional conversion failed:', e);
        }
        
        // Google Ads Conversions (may be blocked)
        try {
          window.dataLayer.push({
            'event': 'conversion',
            'send_to': 'AW-7239891504/urnsCLD0n_waEK_ZhfFA',
            'value': conversionValue,
            'currency': 'UAH'
          });
          console.log('‚úÖ Google Ads conversion 1 sent (AW-7239891504)');
        } catch (e) {
          console.error('‚ùå Google Ads conversion 1 failed:', e);
        }
        
        try {
          window.dataLayer.push({
            'event': 'conversion',
            'send_to': 'AW-17416940719/waLYCNbXjvwaEK_ZhfFA',
            'value': conversionValue,
            'currency': 'UAH'
          });
          console.log('‚úÖ Google Ads conversion 2 sent (AW-17416940719)');
        } catch (e) {
          console.error('‚ùå Google Ads conversion 2 failed:', e);
        }
        
        // Alternative server-side tracking (fallback)
        try {
          fetch('/track-conversion.php', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              value: conversionValue,
              service: serviceType,
              timestamp: new Date().toISOString(),
              userAgent: navigator.userAgent,
              referrer: document.referrer,
              adBlockerDetected: adBlockerDetected
            })
          }).then(() => {
            console.log('‚úÖ Server-side conversion tracking sent');
          }).catch(e => {
            console.log('‚ö†Ô∏è Server-side tracking not available:', e.message);
          });
        } catch (e) {
          console.log('‚ö†Ô∏è Server-side tracking failed:', e);
        }
        
        // Debug logging
        console.log('üìä Conversion Summary:');
        console.log('- Value:', conversionValue, 'UAH');
        console.log('- Service:', serviceType);
        console.log('- GA4 purchase event: Sent');
        console.log('- Google Ads conversions: Sent (may be blocked by ad blocker)');
        
        // Show debug info after delay
        setTimeout(() => {
          updateDebugInfo();
        }, 3000);
      });
      
      // Update debug info on page
      function updateDebugInfo() {
        const debugDiv = document.getElementById('debug-info');
        if (!debugDiv) return;
        
        const gtmLoaded = !!window.google_tag_manager;
        const dataLayerItems = window.dataLayer.length;
        
        debugDiv.innerHTML = `
          <strong>üîç Debug Information:</strong><br>
          <span class="${gtmLoaded ? 'status-ok' : 'status-blocked'}">GTM Container: ${gtmLoaded ? '‚úÖ Loaded' : '‚ùå Not loaded'}</span><br>
          <span class="status-ok">DataLayer Events: ‚úÖ ${dataLayerItems} items</span><br>
          <span class="${adBlockerDetected ? 'status-blocked' : 'status-ok'}">Ad Blocker: ${adBlockerDetected ? '‚ùå Detected (Google Ads blocked)' : '‚úÖ Not detected'}</span><br>
          <span class="status-ok">Conversion Value: ‚úÖ ${conversionValue} UAH</span><br>
          <span class="status-ok">Service Type: ‚úÖ ${serviceType}</span><br>
          <br>
          <strong>üìä Tracking Status:</strong><br>
          ‚Ä¢ GA4 Analytics: ‚úÖ Working (not blocked)<br>
          ‚Ä¢ Google Ads: ${adBlockerDetected ? '‚ùå May be blocked' : '‚úÖ Should work'}<br>
          ‚Ä¢ Server tracking: ‚úÖ Fallback sent<br>
          <br>
          <small>üí° If ad blocker is detected, disable it and refresh page for full tracking</small>
        `;
      }
      
      // Manual trigger function for testing
      window.triggerConversion = function(value = 70) {
        console.log('üß™ Manual conversion trigger with value:', value);
        
        window.dataLayer.push({
          'event': 'manual_conversion_test',
          'conversion_value': value,
          'currency': 'UAH',
          'test_mode': true
        });
        
        return 'Conversion triggered manually with value: ' + value;
      };
      
      // Test function
      window.testConversions = function() {
        console.log('üî¨ Testing all conversion events...');
        
        // Test each conversion individually
        ['70', '280', '350', '450', '570'].forEach((value, index) => {
          setTimeout(() => {
            window.triggerConversion(parseInt(value));
          }, index * 1000);
        });
        
        return 'Testing conversions with different values...';
      };
      
      // Disable ad blocker warning
      window.showAdBlockerWarning = function() {
        const warning = document.createElement('div');
        warning.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: #f44336;
          color: white;
          padding: 15px;
          border-radius: 8px;
          z-index: 10000;
          max-width: 300px;
          font-size: 14px;
        `;
        warning.innerHTML = `
          <strong>‚ö†Ô∏è Ad Blocker Detected</strong><br>
          Google Ads conversions may be blocked.<br>
          GA4 analytics still works.
          <button onclick="this.parentElement.remove()" style="float: right; background: none; border: none; color: white; font-size: 18px; cursor: pointer;">√ó</button>
        `;
        document.body.appendChild(warning);
        
        setTimeout(() => {
          if (warning.parentElement) warning.remove();
        }, 10000);
      };
      
      // Check for ad blocker after page load
      setTimeout(() => {
        if (adBlockerDetected) {
          console.warn('üö® Ad blocker detected - showing warning');
          window.showAdBlockerWarning();
        }
      }, 5000);
    </script>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NVMR3CJ2"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <div class="thank-you-container">
        <div class="success-icon">üéâ</div>
        <h1>–î—è–∫—É—î–º–æ –∑–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è!</h1>
        
        <div class="message">
            <p>–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –ø—Ä–∏–π–Ω—è—Ç–æ!</p>
            <p>–Ø –∑–≤'—è–∂—É—Å—è –∑ –≤–∞–º–∏ –ø—Ä–æ—Ç—è–≥–æ–º <strong>2-3 –≥–æ–¥–∏–Ω</strong> –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–Ω—è –¥–µ—Ç–∞–ª–µ–π —Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó.</p>
        </div>
        
        <div class="contact-info">
            <h3>üìû –ö–æ–Ω—Ç–∞–∫—Ç–∏ –¥–ª—è —Ç–µ—Ä–º—ñ–Ω–æ–≤–∏—Ö –ø–∏—Ç–∞–Ω—å:</h3>
            <p>üìß Email: miaxialip@gmail.com</p>
            <p>üì± Instagram: @miaxialip</p>
            <p>ü§ñ Telegram: @miaxialip_tarot_bot</p>
        </div>
        
        <a href="/" class="btn">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
        <a href="https://instagram.com/miaxialip" class="btn" target="_blank">üì± Instagram</a>
        
        <!-- Debug Panel -->
        <div id="debug-info" class="debug-info">
            Loading debug information...
        </div>
        
        <!-- Test Buttons -->
        <div style="margin-top: 20px; text-align: center;">
            <button onclick="window.triggerConversion(70)" style="margin: 5px; padding: 10px 15px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">Test 70‚Ç¥</button>
            <button onclick="window.triggerConversion(280)" style="margin: 5px; padding: 10px 15px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer;">Test 280‚Ç¥</button>
            <button onclick="window.testConversions()" style="margin: 5px; padding: 10px 15px; background: #FF9800; color: white; border: none; border-radius: 5px; cursor: pointer;">Test All</button>
            <button onclick="console.log('DataLayer:', window.dataLayer)" style="margin: 5px; padding: 10px 15px; background: #9C27B0; color: white; border: none; border-radius: 5px; cursor: pointer;">Show DataLayer</button>
        </div>
        
        <p style="margin-top: 20px; font-size: 12px; opacity: 0.7;">
            –í—ñ–¥–∫—Ä–∏–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12) –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–∏—Ö –ª–æ–≥—ñ–≤ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è
        </p>
    </div>
</body>
</html>